<%- include ('partials/header.ejs') %>

<body class="d-flex flex-column min-vh-100">
    <div class="container">
        <div class="card mt-5">
            <div class="card-header">
                <h2>Cadastro</h2>
            </div>
            <div class="card-body">
                <form class="form-register">
                    <div class="form-group">
                        <div class="avatar">
                            <label for="avatar-input">
                                <img
                                    src="https://i.pinimg.com/originals/92/3c/28/923c28ecd5eaebf767ada2b853180c33.jpg"
                                    alt="pfp"
                                    class="avatar-image"
                                />
                                Escolha a foto do Avatar
                            </label>
                            <input
                                type="file"
                                name="avatar"
                                class="avatar-input form-control-file"
                                id="avatar-input"
                                accept="image/*"
                                required
                            />
                        </div>
                        <div>
                            <label for="exampleInputEmail1" class="mt-3">Nome de usuário</label>
                            <input
                                type="text"
                                class="name-input form-control"
                                name="name"
                                placeholder="Nome do Usuário"
                                min="3"
                                required
                            />
                        </div>

                        <label for="exampleInputEmail1" class="mt-3">Endereço de email</label>
                        <input
                            type="email"
                            class="email-input form-control"
                            name="email"
                            aria-describedby="emailHelp"
                            placeholder="Seu email"
                            required
                        />
                        <small id="emailHelp" class="form-text text-muted"
                            >Nunca vamos compartilhar seu email, com ninguém.</small
                        >

                        <label for="exampleInputPassword1 " class="mt-2">Senha</label>
                        <input
                            type="text"
                            class="form-control password-input"
                            name="password"
                            placeholder="Senha"
                            min="8"
                            required
                        />
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary">Enviar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <%- include ('partials/rodape.ejs') %>
</body>

<%- include ('partials/footer.ejs') %>

<script>
    document.querySelector('.avatar-input').onchange = e => {
        const reader = new FileReader()
        reader.onload = () => {
            document.querySelector('.avatar-image').src = reader.result
        }
        reader.readAsDataURL(e.target.files[0])
    }

    document.querySelector('.form-register').onsubmit = async e => {
        e.preventDefault()

        const avatar = document.querySelector('.avatar-input').files[0]
        const name = document.querySelector('.name-input').value
        const email = document.querySelector('.email-input').value
        const password = document.querySelector('.password-input').value

        var reader = new FileReader()
        reader.readAsBinaryString(avatar)

        reader.onload = async () => {
            try {
                const r = await axios.post('/api/register', {
                    name,
                    email,
                    password,
                    avatar: btoa(reader.result),
                })
                alert('Cadastro realizado com sucesso!')
                window.location.href = '/'
            } catch (e) {
                alert(e.response.data.error)
            }
        }
        reader.onerror = error => {
            console.log('Error: ', error)
        }
    }
</script>
